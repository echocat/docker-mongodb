general:
  artifacts:
    - "images"

machine:
  services:
    - docker

dependencies:
  pre:
    - sudo apt-get update
    - sudo apt-get install build-essential rsync cpio python unzip bc wget curl git ssh scons libmozjs-dev
    - sudo rm -f /usr/bin/gcc && sudo ln -s /usr/bin/gcc-4.8 /usr/bin/gcc && sudo rm -f /usr/bin/g++ && sudo ln -s /usr/bin/g++-4.8 /usr/bin/g++
  override:
    - docker info

test:
  pre:
    - src/detectVersion
  override:
    - src/build

deployment:
  hub:
    branch: /(master|v.*)/
    commands:
      - docker login -e $DOCKERHUB_EMAIL -u $DOCKERHUB_USER -p $DOCKERHUB_PASS
      - src/deploy
